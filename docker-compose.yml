version: '3.8'

services:
  gateway:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      - PORT=8000
      - ANALYSIS_SERVICE_URL=http://analysis-service:8010
      # These should be provided via .env file or docker-compose override
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - GEMINI_API_KEYS=${GEMINI_API_KEYS}
      - MONGODB_URI=${MONGODB_URI}
      - MONGODB_DB_NAME=${MONGODB_DB_NAME:-threatiq}
      - FIREBASE_PROJECT_ID=${FIREBASE_PROJECT_ID}
      - FIREBASE_PRIVATE_KEY=${FIREBASE_PRIVATE_KEY}
      - FIREBASE_CLIENT_EMAIL=${FIREBASE_CLIENT_EMAIL}
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
      - GOOGLE_REDIRECT_URI=${GOOGLE_REDIRECT_URI}
      - FRONTEND_URL=${FRONTEND_URL:-http://localhost:3000}
      - TOKEN_ENCRYPTION_KEY=${TOKEN_ENCRYPTION_KEY}
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost:3000}
    depends_on:
      - analysis-service
    networks:
      - threatiq-network

  analysis-service:
    build:
      context: ./services/analysis-service
      dockerfile: Dockerfile
    ports:
      - "8010:8010"
    environment:
      - PORT=8010
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - GEMINI_API_KEYS=${GEMINI_API_KEYS}
    networks:
      - threatiq-network

networks:
  threatiq-network:
    driver: bridge
